indices:
  - index_name: "dashboard_participants"
    id_field: "study_participant_id"  # Field from query results to use as OpenSearch document _id
    initial_query:
      query: |
        MATCH (:study)<-[:of_study]-(:file)-[:of_participant]->(p:participant)
        RETURN DISTINCT
          p.study_participant_id as study_participant_id,
          p.participant_id as participant_id,
          p.race as race,
          p.sex as sex
        SKIP $skip LIMIT $limit
      page_size: 10000  # Optional pagination size
    update_queries:
      - name: "associated_samples"
        query: |
          MATCH (p:participant)
          WITH p
          SKIP $skip LIMIT $limit
          OPTIONAL MATCH (p)<-[:of_participant]-(samp:sample)
          RETURN DISTINCT
            p.study_participant_id as study_participant_id,
            COLLECT(DISTINCT samp.sample_id) as sample_ids
        page_size: 5000
      - name: "study_counts"
        query: |
          MATCH (s:study)
          WITH s 
          SKIP $skip LIMIT $limit 
          OPTIONAL MATCH (s)<-[:of_study]-(:file)-[:of_participant]->(p:participant)
          OPTIONAL MATCH (p)<-[:of_participant]-(samp:sample)
          WITH s, 
            COLLECT(DISTINCT p.study_participant_id) AS study_participant_ids, 
            COUNT(DISTINCT p) AS num_study_participants, 
            COUNT(DISTINCT samp) AS num_study_samples
          UNWIND study_participant_ids AS study_participant_id
          RETURN
            study_participant_id,
            s.study_name AS study_study_name_filter,
            s.phs_accession AS study_phs_accession_filter,
            s.study_data_types AS study_study_data_type_filter,
            num_study_participants,
            num_study_samples
        page_size: 1


  

